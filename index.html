<!DOCTYPE html>

<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Vardiya Takvimi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <style>
    html, body {
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: flex;
      justify-content: center;
      padding: 16px;
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0 0 8px;
      color: #f8fafc;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .description {
      font-size: 0.9rem;
      color: #94a3b8;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    /* Vardiya Tipi Seçimi */
    .shift-selector {
      margin-bottom: 20px;
    }

    .shift-label {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 10px;
      display: block;
      color: #cbd5e1;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .shift-types {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 24px;
    }

    .shift-type-btn {
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .shift-type-btn:hover {
      border-color: #475569;
      background: #334155;
      transform: translateY(-1px);
    }

    .shift-type-btn.active {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      border-color: #3b82f6;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .shift-main {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .shift-sub {
      font-size: 0.75rem;
      opacity: 0.8;
    }

    /* Çıkış Tarihi Kontrolleri */
    .controls-section {
      margin-bottom: 24px;
    }

    .controls-label {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 10px;
      display: block;
      color: #cbd5e1;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .control-btn {
      padding: 12px 8px;
      border-radius: 10px;
      border: 2px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }

    .control-btn:hover {
      border-color: #475569;
      background: #334155;
      transform: translateY(-1px);
    }

    .control-btn.active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-color: #10b981;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Takvim */
    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .month-title {
      font-weight: 700;
      font-size: 1.15rem;
      color: #f8fafc;
      letter-spacing: -0.01em;
    }

    .cal-nav-btn {
      border-radius: 8px;
      border: 2px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .cal-nav-btn:hover {
      background: #334155;
      border-color: #475569;
      transform: translateY(-1px);
    }

    .cal-nav-btn:active {
      transform: scale(0.97);
    }

    /* Gösterge */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 0.8rem;
      margin-bottom: 16px;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #cbd5e1;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .dot-work {
      background: #ef4444;
    }

    .dot-off {
      background: #10b981;
    }

    .dot-today {
      background: transparent;
      width: 8px;
      height: 8px;
      border: 2px solid #3b82f6;
    }

    /* Takvim Izgarası */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }

    .weekday-header {
      text-align: center;
      padding: 8px 0;
      color: #64748b;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .day-cell {
      aspect-ratio: 1 / 1;
      border-radius: 10px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 600;
      background: #1e293b;
      color: #cbd5e1;
      transition: all 0.2s;
      position: relative;
    }

    .weekend {
      color: #64748b;
    }

    .work-day {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #ffffff;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
    }

    .off-day {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
    }

    .today .day-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2em;
      height: 2em;
      border-radius: 50%;
      background: #3b82f6;
      color: #ffffff;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .work-day.today .day-number,
    .off-day.today .day-number {
      background: #ffffff;
      color: #0f172a;
      font-weight: 700;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    .empty {
      background: transparent;
    }
  </style>

</head>
<body>
<main class="container">
  <h1>⏰ Vardiya Takvimi</h1>
  <p class="description">
    Vardiya tipini ve en son işten çıktığın günü seç. Takvim otomatik olarak renklensin.
  </p>

  <!-- Vardiya Tipi Seçimi -->

  <section class="shift-selector">
    <label class="shift-label">Vardiya Tipi</label>
    <div class="shift-types">
      <button type="button" class="shift-type-btn active" id="shift2448">
        <span class="shift-main">24/48</span>
        <span class="shift-sub">24s çalış, 48s tat</span>
      </button>
      <button type="button" class="shift-type-btn" id="shift1236">
        <span class="shift-main">12/36</span>
        <span class="shift-sub">12s çalış, 36s tat</span>
      </button>
    </div>
  </section>

  <!-- Çıkış Tarihi Kontrolleri -->

  <section class="controls-section">
    <label class="controls-label">İşten Çıkış</label>
    <div class="controls-grid">
      <button type="button" class="control-btn" id="setToday">Bugün</button>
      <button type="button" class="control-btn" id="setYesterday">Dün</button>
      <button type="button" class="control-btn" id="setTwoDaysAgo">2 Gün Önce</button>
    </div>
  </section>

  <!-- Takvim -->

  <section>
    <div class="calendar-header">
      <button class="cal-nav-btn" id="prevMonthBtn">◀ Önceki</button>
      <div class="month-title" id="monthTitle"></div>
      <button class="cal-nav-btn" id="nextMonthBtn">Sonraki ▶</button>
    </div>

```
<div class="legend">
  <div class="legend-item">
    <span class="dot dot-work"></span> Çalışma
  </div>
  <div class="legend-item">
    <span class="dot dot-off"></span> Tatil
  </div>
  <div class="legend-item">
    <span class="dot dot-today"></span> Bugün
  </div>
</div>

<div class="calendar-grid" id="calendarGrid"></div>
```

  </section>
</main>

<script>
  document.addEventListener("contextmenu", (e) => e.preventDefault());
  let lastTouchEnd = 0;
  document.addEventListener("touchend", (event) => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });

  const trMonths = [
    "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran",
    "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"
  ];
  const trWeekdaysShort = ["Pzt", "Sal", "Çar", "Per", "Cum", "Cmt", "Paz"];

  const shift2448Btn = document.getElementById("shift2448");
  const shift1236Btn = document.getElementById("shift1236");
  const setTodayBtn = document.getElementById("setToday");
  const setYesterdayBtn = document.getElementById("setYesterday");
  const setTwoDaysAgoBtn = document.getElementById("setTwoDaysAgo");
  const monthTitle = document.getElementById("monthTitle");
  const calendarGrid = document.getElementById("calendarGrid");
  const prevMonthBtn = document.getElementById("prevMonthBtn");
  const nextMonthBtn = document.getElementById("nextMonthBtn");

  let lastExitDate = null;
  let shiftType = "24-48"; // Varsayılan
  const today = new Date();
  let currentYear = today.getFullYear();
  let currentMonth = today.getMonth();

  function formatDate(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const da = String(d.getDate()).padStart(2, "0");
    return `${y}-${m}-${da}`;
  }

  function toDateOnly(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  function sameDate(a, b) {
    return (
      a.getFullYear() === b.getFullYear() &&
      a.getMonth() === b.getMonth() &&
      a.getDate() === b.getDate()
    );
  }

  function saveShiftType(type) {
    shiftType = type;
    localStorage.setItem("shiftType", type);
    
    shift2448Btn.classList.toggle("active", type === "24-48");
    shift1236Btn.classList.toggle("active", type === "12-36");
    
    renderCalendar();
  }

  function saveLastExitDate(dateStr) {
    if (!dateStr) return;
    localStorage.setItem("lastExitDate", dateStr);
    lastExitDate = new Date(dateStr + "T00:00:00");
    
    updateActiveButtons(dateStr);
    renderCalendar();
  }

  function updateActiveButtons(dateStr) {
    const todayDate = new Date();
    const yesterdayDate = new Date();
    yesterdayDate.setDate(todayDate.getDate() - 1);
    const twoDaysAgoDate = new Date();
    twoDaysAgoDate.setDate(todayDate.getDate() - 2);

    const todayStr = formatDate(todayDate);
    const yesterdayStr = formatDate(yesterdayDate);
    const twoDaysAgoStr = formatDate(twoDaysAgoDate);

    setTodayBtn.classList.toggle("active", dateStr === todayStr);
    setYesterdayBtn.classList.toggle("active", dateStr === yesterdayStr);
    setTwoDaysAgoBtn.classList.toggle("active", dateStr === twoDaysAgoStr);
  }

  function setExitFromOffset(offsetDays) {
    const d = new Date();
    d.setDate(d.getDate() - offsetDays);
    const str = formatDate(d);
    saveLastExitDate(str);
  }

  function loadFromStorage() {
    const storedShift = localStorage.getItem("shiftType");
    if (storedShift) {
      shiftType = storedShift;
      shift2448Btn.classList.toggle("active", shiftType === "24-48");
      shift1236Btn.classList.toggle("active", shiftType === "12-36");
    }

    const stored = localStorage.getItem("lastExitDate");
    if (stored) {
      saveLastExitDate(stored);
    } else {
      setExitFromOffset(0);
    }
  }

  function getDayType(date) {
    if (!lastExitDate) return "none";
    const msPerDay = 24 * 60 * 60 * 1000;
    const diff = Math.floor((toDateOnly(date) - lastExitDate) / msPerDay);
    
    if (shiftType === "24-48") {
      // 24/48: 3 günlük döngü
      // Gün 0-1: Tatil, Gün 2: Çalışma
      const mod = ((diff % 3) + 3) % 3;
      if (mod === 0 || mod === 1) return "off";
      if (mod === 2) return "work";
    } else if (shiftType === "12-36") {
      // 12/36: 2 günlük döngü
      // Gün 0: Tatil, Gün 1: Çalışma
      const mod = ((diff % 2) + 2) % 2;
      if (mod === 0) return "off";
      if (mod === 1) return "work";
    }
    
    return "none";
  }

  function isWeekend(date) {
    const jsDay = date.getDay();
    return jsDay === 0 || jsDay === 6;
  }

  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const todayDateOnly = toDateOnly(today);

    trWeekdaysShort.forEach(day => {
      const div = document.createElement("div");
      div.className = "weekday-header";
      div.textContent = day;
      calendarGrid.appendChild(div);
    });

    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const firstWeekdayIndex = (firstDay.getDay() + 6) % 7;

    for (let i = 0; i < firstWeekdayIndex; i++) {
      const cell = document.createElement("div");
      cell.className = "day-cell empty";
      calendarGrid.appendChild(cell);
    }

    for (let day = 1; day <= lastDay.getDate(); day++) {
      const date = new Date(currentYear, currentMonth, day);
      const cell = document.createElement("div");
      cell.className = "day-cell";

      const type = getDayType(date);

      if (type === "work") {
        cell.classList.add("work-day");
      } else if (type === "off") {
        cell.classList.add("off-day");
      }

      if (isWeekend(date)) {
        cell.classList.add("weekend");
      }

      if (sameDate(date, todayDateOnly)) {
        cell.classList.add("today");
      }

      const numSpan = document.createElement("span");
      numSpan.className = "day-number";
      numSpan.textContent = day;

      cell.appendChild(numSpan);
      calendarGrid.appendChild(cell);
    }

    monthTitle.textContent = `${trMonths[currentMonth]} ${currentYear}`;
  }

  shift2448Btn.addEventListener("click", () => saveShiftType("24-48"));
  shift1236Btn.addEventListener("click", () => saveShiftType("12-36"));

  setTodayBtn.addEventListener("click", () => setExitFromOffset(0));
  setYesterdayBtn.addEventListener("click", () => setExitFromOffset(1));
  setTwoDaysAgoBtn.addEventListener("click", () => setExitFromOffset(2));

  prevMonthBtn.addEventListener("click", () => {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
    renderCalendar();
  });

  nextMonthBtn.addEventListener("click", () => {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    renderCalendar();
  });

  loadFromStorage();
</script>

</body>
</html>