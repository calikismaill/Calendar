<!DOCTYPE html>

<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Vardiya Takvimi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- Lucide Icons -->

  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    html, body {
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      height: 100%;
      overflow: hidden;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 12px;
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.3rem;
      margin: 0 0 6px;
      color: #f8fafc;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .description {
      font-size: 0.8rem;
      color: #64748b;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    /* Vardiya Tipi - Daha Az Oval */
    .shift-label {
      font-size: 0.7rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .shift-types {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-bottom: 12px;
    }

    .shift-type-btn {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1.5px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .shift-type-btn svg {
      width: 18px;
      height: 18px;
      margin-bottom: 2px;
    }

    .shift-type-btn:active {
      transform: scale(0.97);
    }

    .shift-type-btn.active {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      border-color: #3b82f6;
      color: #ffffff;
    }

    .shift-main {
      font-size: 0.95rem;
      font-weight: 700;
    }

    .shift-sub {
      font-size: 0.65rem;
      opacity: 0.75;
    }

    /* √áƒ±kƒ±≈ü Tarihi - Daha Az Oval */
    .controls-label {
      font-size: 0.7rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }

    .control-btn {
      padding: 8px 6px;
      border-radius: 6px;
      border: 1.5px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s ease;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }

    .control-btn svg {
      width: 16px;
      height: 16px;
    }

    .control-btn:active {
      transform: scale(0.97);
    }

    .control-btn.active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-color: #10b981;
      color: #ffffff;
    }

    /* Takvim Ba≈ülƒ±k - Yeni D√ºzen */
    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }

    .today-btn {
      border-radius: 6px;
      border: none;
      background: #1e40af;
      color: #fff;
      padding: 10px 14px;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .today-btn svg {
      width: 22px;
      height: 22px;
    }

    .today-btn:active {
      transform: scale(0.95);
    }

    .month-title {
      font-weight: 700;
      font-size: 1.1rem;
      color: #f8fafc;
      letter-spacing: -0.01em;
      cursor: pointer;
      padding: 10px 12px;
      border-radius: 6px;
      background: #1e293b;
      border: 1.5px solid #334155;
      flex: 1;
      text-align: center;
    }

    .month-nav {
      display: flex;
      gap: 6px;
    }

    .cal-nav-btn {
      border-radius: 6px;
      border: 1.5px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      padding: 10px 16px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cal-nav-btn svg {
      width: 20px;
      height: 20px;
    }

    .cal-nav-btn:active {
      transform: scale(0.95);
    }

    /* ƒ∞statistik - Yatay D√ºzen */
    .stats {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      font-size: 0.75rem;
    }

    .stat-item {
      flex: 1;
      padding: 8px 10px;
      border-radius: 6px;
      background: #1e293b;
      border: 1.5px solid #334155;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .stat-value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .stat-work .stat-value { color: #ef4444; }
    .stat-off .stat-value { color: #10b981; }

    .stat-label {
      font-size: 0.7rem;
      color: #64748b;
    }

    /* G√∂sterge */
    .legend {
      display: flex;
      gap: 12px;
      font-size: 0.7rem;
      margin-bottom: 10px;
      justify-content: center;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #94a3b8;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .dot-work { background: #ef4444; }
    .dot-off { background: #10b981; }
    .dot-today {
      background: transparent;
      width: 6px;
      height: 6px;
      border: 2px solid #3b82f6;
    }

    /* Takvim - Daha Az Oval */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .weekday-header {
      text-align: center;
      padding: 4px 0;
      color: #475569;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .day-cell {
      aspect-ratio: 1 / 1;
      border-radius: 6px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      background: #1e293b;
      color: #cbd5e1;
      transition: all 0.2s;
      position: relative;
      border: 1.5px solid transparent;
    }

    /* Hafta sonu - Siyah yazƒ± */
    .weekend {
      color: #0f172a;
    }

    .work-day {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #ffffff;
      border-color: transparent;
    }

    .off-day {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      border-color: transparent;
    }

    /* Hafta sonu √ßalƒ±≈üma/tatil g√ºnlerinde siyah yazƒ± */
    .work-day.weekend,
    .off-day.weekend {
      color: #0f172a;
    }

    .today .day-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 1.9em;
      height: 1.9em;
      border-radius: 50%;
      background: #3b82f6;
      color: #ffffff;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    .work-day.today .day-number,
    .off-day.today .day-number {
      background: #ffffff;
      color: #0f172a;
      font-weight: 700;
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.4);
    }

    .empty {
      background: transparent;
      border-color: transparent;
    }

    /* Ay Se√ßici Modal */
    .month-picker-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .month-picker-overlay.active {
      display: flex;
    }

    .month-picker {
      background: #1e293b;
      border-radius: 10px;
      padding: 16px;
      max-width: 320px;
      width: 90%;
      border: 2px solid #334155;
    }

    .picker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .picker-title {
      font-size: 1rem;
      font-weight: 700;
      color: #f8fafc;
    }

    .picker-close {
      background: transparent;
      border: none;
      color: #94a3b8;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .year-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .year-btn {
      background: #334155;
      border: none;
      color: #e2e8f0;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    .year-display {
      font-size: 1.1rem;
      font-weight: 700;
      color: #f8fafc;
      min-width: 80px;
      text-align: center;
    }

    .months-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .month-option {
      padding: 12px 8px;
      background: #334155;
      border: 2px solid transparent;
      border-radius: 6px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: #cbd5e1;
      cursor: pointer;
      transition: all 0.2s;
    }

    .month-option:active {
      transform: scale(0.95);
    }

    .month-option.current {
      background: #3b82f6;
      color: #fff;
    }
  </style>

</head>
<body>
<main class="container">
  <h1>‚è∞ Vardiya Takvimi</h1>
  <p class="description">
    Vardiya tipini ve en son i≈üten √ßƒ±ktƒ±ƒüƒ±n g√ºn√º se√ß.
  </p>

  <!-- Vardiya Tipi -->

<label class="shift-label">Vardiya Tipi</label>

  <div class="shift-types">
    <button type="button" class="shift-type-btn active" id="shift2448">
      <span class="shift-main">24/48</span>
      <span class="shift-sub">24s √ßalƒ±≈ü, 48s tat</span>
    </button>
    <button type="button" class="shift-type-btn" id="shift1236">
      <span class="shift-main">12/36</span>
      <span class="shift-sub">12s √ßalƒ±≈ü, 36s tat</span>
    </button>
  </div>

  <!-- √áƒ±kƒ±≈ü Tarihi -->

<label class="controls-label">ƒ∞≈üten √áƒ±kƒ±≈ü</label>

  <div class="controls-grid">
    <button type="button" class="control-btn" id="setToday">Bug√ºn</button>
    <button type="button" class="control-btn" id="setYesterday">D√ºn</button>
    <button type="button" class="control-btn" id="setTwoDaysAgo">2 G√ºn √ñnce</button>
  </div>

  <!-- Takvim Ba≈ülƒ±k -->

  <div class="calendar-header">
    <button class="today-btn" id="todayBtn">üè†</button>
    <div class="month-title" id="monthTitle"></div>
    <div class="month-nav">
      <button class="cal-nav-btn" id="prevMonthBtn">‚óÄ</button>
      <button class="cal-nav-btn" id="nextMonthBtn">‚ñ∂</button>
    </div>
  </div>

  <!-- ƒ∞statistik -->

  <div class="stats">
    <div class="stat-item stat-work">
      <span class="stat-value" id="workDays">0</span>
      <span class="stat-label">√áalƒ±≈üma</span>
    </div>
    <div class="stat-item stat-off">
      <span class="stat-value" id="offDays">0</span>
      <span class="stat-label">Tatil</span>
    </div>
  </div>

  <!-- G√∂sterge -->

  <div class="legend">
    <div class="legend-item">
      <span class="dot dot-work"></span> √áalƒ±≈üma
    </div>
    <div class="legend-item">
      <span class="dot dot-off"></span> Tatil
    </div>
    <div class="legend-item">
      <span class="dot dot-today"></span> Bug√ºn
    </div>
  </div>

  <!-- Takvim -->

  <div class="calendar-grid" id="calendarGrid"></div>
</main>

<!-- Ay Se√ßici Modal -->

<div class="month-picker-overlay" id="monthPickerOverlay">
  <div class="month-picker">
    <div class="picker-header">
      <div class="picker-title">Ay Se√ß</div>
      <button class="picker-close" id="pickerClose">√ó</button>
    </div>
    <div class="year-selector">
      <button class="year-btn" id="prevYearBtn">‚óÄ</button>
      <div class="year-display" id="yearDisplay"></div>
      <button class="year-btn" id="nextYearBtn">‚ñ∂</button>
    </div>
    <div class="months-grid" id="monthsGrid"></div>
  </div>
</div>

<script>
  document.addEventListener("contextmenu", (e) => e.preventDefault());
  let lastTouchEnd = 0;
  document.addEventListener("touchend", (event) => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });

  const trMonths = [
    "Ocak", "≈ûubat", "Mart", "Nisan", "Mayƒ±s", "Haziran",
    "Temmuz", "Aƒüustos", "Eyl√ºl", "Ekim", "Kasƒ±m", "Aralƒ±k"
  ];
  const trWeekdaysShort = ["Pzt", "Sal", "√áar", "Per", "Cum", "Cmt", "Paz"];

  const shift2448Btn = document.getElementById("shift2448");
  const shift1236Btn = document.getElementById("shift1236");
  const setTodayBtn = document.getElementById("setToday");
  const setYesterdayBtn = document.getElementById("setYesterday");
  const setTwoDaysAgoBtn = document.getElementById("setTwoDaysAgo");
  const monthTitle = document.getElementById("monthTitle");
  const calendarGrid = document.getElementById("calendarGrid");
  const prevMonthBtn = document.getElementById("prevMonthBtn");
  const nextMonthBtn = document.getElementById("nextMonthBtn");
  const todayBtn = document.getElementById("todayBtn");
  const workDaysEl = document.getElementById("workDays");
  const offDaysEl = document.getElementById("offDays");
  const monthPickerOverlay = document.getElementById("monthPickerOverlay");
  const pickerClose = document.getElementById("pickerClose");
  const prevYearBtn = document.getElementById("prevYearBtn");
  const nextYearBtn = document.getElementById("nextYearBtn");
  const yearDisplay = document.getElementById("yearDisplay");
  const monthsGrid = document.getElementById("monthsGrid");

  let lastExitDate = null;
  let shiftType = "24-48";
  const today = new Date();
  let currentYear = today.getFullYear();
  let currentMonth = today.getMonth();
  let pickerYear = currentYear;

  function formatDate(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const da = String(d.getDate()).padStart(2, "0");
    return `${y}-${m}-${da}`;
  }

  function toDateOnly(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  function sameDate(a, b) {
    return (
      a.getFullYear() === b.getFullYear() &&
      a.getMonth() === b.getMonth() &&
      a.getDate() === b.getDate()
    );
  }

  function saveShiftType(type) {
    shiftType = type;
    localStorage.setItem("shiftType", type);
    
    shift2448Btn.classList.toggle("active", type === "24-48");
    shift1236Btn.classList.toggle("active", type === "12-36");
    
    renderCalendar();
  }

  function saveLastExitDate(dateStr) {
    if (!dateStr) return;
    localStorage.setItem("lastExitDate", dateStr);
    lastExitDate = new Date(dateStr + "T00:00:00");
    
    updateActiveButtons(dateStr);
    renderCalendar();
  }

  function updateActiveButtons(dateStr) {
    const todayDate = new Date();
    const yesterdayDate = new Date();
    yesterdayDate.setDate(todayDate.getDate() - 1);
    const twoDaysAgoDate = new Date();
    twoDaysAgoDate.setDate(todayDate.getDate() - 2);

    const todayStr = formatDate(todayDate);
    const yesterdayStr = formatDate(yesterdayDate);
    const twoDaysAgoStr = formatDate(twoDaysAgoDate);

    setTodayBtn.classList.toggle("active", dateStr === todayStr);
    setYesterdayBtn.classList.toggle("active", dateStr === yesterdayStr);
    setTwoDaysAgoBtn.classList.toggle("active", dateStr === twoDaysAgoStr);
  }

  function setExitFromOffset(offsetDays) {
    const d = new Date();
    d.setDate(d.getDate() - offsetDays);
    const str = formatDate(d);
    saveLastExitDate(str);
  }

  function loadFromStorage() {
    const storedShift = localStorage.getItem("shiftType");
    if (storedShift) {
      shiftType = storedShift;
      shift2448Btn.classList.toggle("active", shiftType === "24-48");
      shift1236Btn.classList.toggle("active", shiftType === "12-36");
    }

    const stored = localStorage.getItem("lastExitDate");
    if (stored) {
      saveLastExitDate(stored);
    } else {
      setExitFromOffset(0);
    }
  }

  function getDayType(date) {
    if (!lastExitDate) return "none";
    const msPerDay = 24 * 60 * 60 * 1000;
    const diff = Math.floor((toDateOnly(date) - lastExitDate) / msPerDay);
    
    if (shiftType === "24-48") {
      const mod = ((diff % 3) + 3) % 3;
      if (mod === 0 || mod === 1) return "off";
      if (mod === 2) return "work";
    } else if (shiftType === "12-36") {
      const mod = ((diff % 2) + 2) % 2;
      if (mod === 0) return "off";
      if (mod === 1) return "work";
    }
    
    return "none";
  }

  function isWeekend(date) {
    const jsDay = date.getDay();
    return jsDay === 0 || jsDay === 6;
  }

  function calculateStats() {
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    let workCount = 0;
    let offCount = 0;

    for (let day = 1; day <= lastDay.getDate(); day++) {
      const date = new Date(currentYear, currentMonth, day);
      const type = getDayType(date);
      if (type === "work") workCount++;
      else if (type === "off") offCount++;
    }

    workDaysEl.textContent = workCount;
    offDaysEl.textContent = offCount;
  }

  function renderCalendar() {
    calendarGrid.innerHTML = "";
    const todayDateOnly = toDateOnly(today);

    trWeekdaysShort.forEach(day => {
      const div = document.createElement("div");
      div.className = "weekday-header";
      div.textContent = day;
      calendarGrid.appendChild(div);
    });

    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const firstWeekdayIndex = (firstDay.getDay() + 6) % 7;

    for (let i = 0; i < firstWeekdayIndex; i++) {
      const cell = document.createElement("div");
      cell.className = "day-cell empty";
      calendarGrid.appendChild(cell);
    }

    for (let day = 1; day <= lastDay.getDate(); day++) {
      const date = new Date(currentYear, currentMonth, day);
      const cell = document.createElement("div");
      cell.className = "day-cell";

      const type = getDayType(date);

      if (type === "work") {
        cell.classList.add("work-day");
      } else if (type === "off") {
        cell.classList.add("off-day");
      }

      if (isWeekend(date)) {
        cell.classList.add("weekend");
      }

      if (sameDate(date, todayDateOnly)) {
        cell.classList.add("today");
      }

      const numSpan = document.createElement("span");
      numSpan.className = "day-number";
      numSpan.textContent = day;

      cell.appendChild(numSpan);
      calendarGrid.appendChild(cell);
    }

    monthTitle.textContent = `${trMonths[currentMonth]} ${currentYear}`;
    calculateStats();
  }

  function goToToday() {
    currentYear = today.getFullYear();
    currentMonth = today.getMonth();
    renderCalendar();
  }

  function openMonthPicker() {
    pickerYear = currentYear;
    renderMonthPicker();
    monthPickerOverlay.classList.add("active");
  }

  function closeMonthPicker() {
    monthPickerOverlay.classList.remove("active");
  }

  function renderMonthPicker() {
    yearDisplay.textContent = pickerYear;
    monthsGrid.innerHTML = "";

    trMonths.forEach((month, index) => {
      const btn = document.createElement("div");
      btn.className = "month-option";
      btn.textContent = month;
      
      if (index === currentMonth && pickerYear === currentYear) {
        btn.classList.add("current");
      }

      btn.addEventListener("click", () => {
        currentMonth = index;
        currentYear = pickerYear;
        renderCalendar();
        closeMonthPicker();
      });

      monthsGrid.appendChild(btn);
    });
  }

  shift2448Btn.addEventListener("click", () => saveShiftType("24-48"));
  shift1236Btn.addEventListener("click", () => saveShiftType("12-36"));

  setTodayBtn.addEventListener("click", () => setExitFromOffset(0));
  setYesterdayBtn.addEventListener("click", () => setExitFromOffset(1));
  setTwoDaysAgoBtn.addEventListener("click", () => setExitFromOffset(2));

  prevMonthBtn.addEventListener("click", () => {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
    renderCalendar();
  });

  nextMonthBtn.addEventListener("click", () => {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    renderCalendar();
  });

  todayBtn.addEventListener("click", goToToday);
  monthTitle.addEventListener("click", openMonthPicker);
  pickerClose.addEventListener("click", closeMonthPicker);
  monthPickerOverlay.addEventListener("click", (e) => {
    if (e.target === monthPickerOverlay) closeMonthPicker();
  });

  prevYearBtn.addEventListener("click", () => {
    pickerYear--;
    renderMonthPicker();
  });

  nextYearBtn.addEventListener("click", () => {
    pickerYear++;
    renderMonthPicker();
  });

  loadFromStorage();
  
  // Lucide ikonlarƒ±nƒ± ba≈ülat
  lucide.createIcons();
</script>

</body>
</html>